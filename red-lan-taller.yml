name: labtaller
mgmt:
  network: lan
  ipv4-subnet: 172.30.30.0/24
topology:
  nodes:
  
    router-cisco:
      kind: cisco_iol
      image: docker.io/arthurk99/cisco-iol:17.15.01
      startup-config: configs/config.partial
             
    switch-arista:
      kind: arista_ceos
      image: docker.io/arthurk99/arista-ceos:4.30.2F
      startup-config: switch/configslaac.conf

    PC1:
      kind: linux # "Alpine Linux v3.12"
      image: ghcr.io/hellt/network-multitool
      binds:
       - configs/dhcp-client.sh:/root/dhcp-client.sh
      exec:
       - "sysctl net.ipv6.conf.eth1.addr_gen_mode=3"
       - chmod +x /root/dhcp-client.sh
       - bash /root/dhcp-client.sh
       - ip -6 route del default dev eth0
       - ip route del default dev eth0
            
    PC2:
      kind: linux # "Alpine Linux v3.12"
      image: ghcr.io/hellt/network-multitool
      binds:
       - configs/dhcp-client.sh:/root/dhcp-client.sh
      exec:
       - chmod +x /root/dhcp-client.sh
       - bash /root/dhcp-client.sh
       - "sysctl net.ipv6.conf.eth1.addr_gen_mode=3"
       - "sysctl net.ipv6.conf.eth1.addr_gen_mode=2"
       - "sysctl net.ipv6.conf.eth1.use_tempaddr=2"  
       - ip route del default dev eth0
          
    PC3: 
      kind: linux # "Alpine Linux v3.12"
      image: ghcr.io/hellt/network-multitool
      binds:
       - configs/dhcp-client.sh:/root/dhcp-client.sh
      exec:
       - chmod +x /root/dhcp-client.sh
       - bash /root/dhcp-client.sh
       - ip -6 route del default dev eth0
       - ip route del default dev eth0

    server-web:
      kind: linux
      image: docker.io/esanchezv/srvhttps:latest
      exec:
       - ip -6 addr add 2001:db8:50::10/64 dev eth1
       - ip route del default dev eth0
       - ip -6 route del default dev eth0
       - ip -6 route add default via 2001:db8:50::1
      binds:
       - configs/tallerclab.html:/var/www/localhost/htdocs/index.html
           

  links:
    - endpoints: ["router-cisco:Ethernet0/1","switch-arista:eth1"]
    - endpoints: ["router-cisco:Ethernet0/2","server-web:eth1"]
    - endpoints: ["PC1:eth1","switch-arista:eth2"]
      mtu: 1500
    - endpoints: ["PC2:eth1","switch-arista:eth3"]
      mtu: 1500
    - endpoints: ["PC3:eth1","switch-arista:eth4"]
      mtu: 1500      
